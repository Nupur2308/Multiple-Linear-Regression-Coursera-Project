---
title: "Modeling and Prediction for Movies using Linear Regression"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    keep_md: yes
    theme: spacelab
---

## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
library(statsr)
library(tidyr)
library(cowplot)
library(ggplotify)
library(purrr)
```

### Load data


```{r load-data}
load("movies.Rdata")
```


* * *

# Part 1: Data

The data consists of randomly sampled movies, findings can be theoretically generalized to the population. However, data on only English movies has been collected, and only movies that can be found online. Thus, there may be reservations in generalizing to the population of all movies ever made. 

Additionally, very few attributes have been collected. There could be qualitative findings conducted via interviews that might yield better insights. 

This is an observational study without random assigment, thus there is no causality, only associations. 
* * *

# Part 2: Research question

>> What variables are associated with the popularity of a movie? 

This research question is of interest as our boss wants to know what attributes make a movie popular. 

* * *

# Part 3: Exploratory data analysis

First, we want to remove all NA values and then summarise the type and level of each variable

```{r}
movies<-na.omit(movies)
str(movies)
```

I will be using imdb_rating as the response variable. I have a feeling that critics score & rating and audience scores & rating on rotten tomatoes are correlated. So let's find out. 

```{r}
cor(movies$critics_score,movies$audience_score)
```

This is a pretty high correlation. Let's check audience rating and critics rating using the chi-square test. 

```{r}
chisq.test(movies$critics_rating,movies$audience_rating,correct=FALSE)
```

The critics rating and audience rating are definitely dependent. We can also see these conclusions from the graphs below. 

```{r fig.height=5, fig.width=12}
plot1<- ggplot(movies,aes(x=critics_score,y=audience_score))+geom_point()
plot2<- ggplot(movies) + aes(x=critics_rating,fill=audience_rating) + geom_bar(position="fill")+scale_y_continuous(labels = scales::percent)
plot_grid(plot1,plot2,ncol=2,rel_widths=c(1,1.3))
```


We don't want collinear variables in the model, so we will use only audience score as using critics score and audience rating will add nothing new to the model.  

Additionally, instead of using critics rating, I want to simplify and introduce a variable that labels a movie as Rotten or not, depending on whether it has received a rotten critics_rating or not. 

```{r}
movies<-movies%>%mutate(rotten=as.factor(ifelse(critics_rating=="Rotten","Y","N")))
```


Let's also look at scatter plots of all the selected variables (numerical and categorical) against our response variable imdb_rating, to get an idea of what attributes show an association with popularity. 

```{r fig.height=10, fig.width=10}

movies%>% keep(is.numeric)%>%  gather(-imdb_rating, key = "var", value = "value") %>%
  ggplot(aes(x = value, y = imdb_rating)) +
    geom_point() +
    facet_wrap(~ var, scales = "free",ncol=3) +
    theme_bw()+
    ggtitle("Numeric variables plotted against IMDB_RATING")

```


It seems like audience_score has a definite linear relationship with imdb_rating. imdb_num_votes and runtime seem to have a weak linear relationship with imdb_rating. The rest of the variables seem to be randomly scattered. 

Now let's take a look at categorical variables and plot them against imbd_rating. 

```{r fig.height=8, fig.width=10}
movies_cat<-movies[,c(13,5,19,20,21,22,23,24,33)]
movies_cat%>% gather(-imdb_rating, key = "var", value = "value") %>%
  ggplot(aes(x = value, y = imdb_rating)) +
    geom_point() +
    facet_wrap(~ var, scales = "free",ncol=3) +
    theme_bw()+
    ggtitle("Categoric variables plotted against IMDB_RATING")
```

In the case of the variable 'rotten', we see that there is a clear relationship where rotten movies have a lower imdb rating on average compared to non-rotten ones. The average ratings for movies with best_pic_nom/best_dir_win also seem to be higher. 

```{r}
movies%>% ggplot(aes(x = genre, y = imdb_rating)) +
    geom_point()+theme(axis.text.x = element_text(angle = 90))
```

There seems to be a relationship between genre and imdb_ratings. Documentary genre is associated with higher imdb ratings on average. 

* * *

# Part 4: Modeling

Since we are tasked with learning what attributes makes a movie popular, and not just necessarily develop a model with the best predictions, we are choosing to go with backward selection based on the p-value. We start with the full model with all variables and then drop the variables with the highest p-values until we are left with a model that contains only significant explanatory variables.  

As mentioned before, we are using the variables audience score and rotten instead of critics score and audience rating. Also, we are not considering  the variables studio, director, and actor1 to actor5 as they have too many levels/categories. We are also not choosing the imdb_url or rt_url as these are meaningless to the exercise. Below is the full model.


```{r}

m1<-lm(formula=imdb_rating~title_type+genre+runtime+mpaa_rating+thtr_rel_year+thtr_rel_month+thtr_rel_day+dvd_rel_year+dvd_rel_month+dvd_rel_day+imdb_num_votes+audience_score+rotten+best_pic_nom+best_pic_win+best_actor_win+best_actress_win+best_dir_win+top200_box,data=movies)

summary(m1)
```
```{r}
#Dropping best_pic_win
m2<-lm(formula=imdb_rating~title_type+genre+runtime+mpaa_rating+thtr_rel_year+thtr_rel_month+thtr_rel_day+dvd_rel_year+dvd_rel_month+dvd_rel_day+imdb_num_votes+audience_score+rotten+best_pic_nom+best_actor_win+best_actress_win+best_dir_win+top200_box,data=movies)

summary(m2)
```
```{r}
#Dropping mpaa_rating
m3<-lm(formula=imdb_rating~title_type+genre+runtime+thtr_rel_year+thtr_rel_month+thtr_rel_day+dvd_rel_year+dvd_rel_month+dvd_rel_day+imdb_num_votes+audience_score+rotten+best_pic_nom+best_actor_win+best_actress_win+best_dir_win+top200_box,data=movies)

summary(m3)
```
```{r}
#Drop dvd_rel_year
m4<-lm(formula=imdb_rating~title_type+genre+runtime+thtr_rel_year+thtr_rel_month+thtr_rel_day+dvd_rel_month+dvd_rel_day+imdb_num_votes+audience_score+rotten+best_pic_nom+best_actor_win+best_actress_win+best_dir_win+top200_box,data=movies)


summary(m4)
```
```{r}
#Drop thtr_rel_year
m4.5<-lm(formula=imdb_rating~title_type+genre+runtime+thtr_rel_month+thtr_rel_day+dvd_rel_month+dvd_rel_day+imdb_num_votes+audience_score+rotten+best_pic_nom+best_actor_win+best_actress_win+best_dir_win+top200_box,data=movies)

summary(m4.5)
```

```{r}
#Drop dvd_rel_day
m5<-lm(formula=imdb_rating~title_type+genre+runtime+thtr_rel_month+thtr_rel_day+dvd_rel_month+imdb_num_votes+audience_score+rotten+best_pic_nom+best_actor_win+best_actress_win+best_dir_win+top200_box,data=movies)

summary(m5)
```
```{r}
#Drop thtr_rel_day
m6<-lm(formula=imdb_rating~title_type+genre+runtime+thtr_rel_month+dvd_rel_month+imdb_num_votes+audience_score+rotten+best_pic_nom+best_actor_win+best_actress_win+best_dir_win+top200_box,data=movies)

summary(m6)
```
```{r}
#Drop best_actor_win
m7<-lm(formula=imdb_rating~title_type+genre+runtime+thtr_rel_month+dvd_rel_month+imdb_num_votes+audience_score+rotten+best_pic_nom+best_actress_win+best_dir_win+top200_box,data=movies)

summary(m7)
```
```{r}
#Drop top200_box
m8<-lm(formula=imdb_rating~title_type+genre+runtime+thtr_rel_month+dvd_rel_month+imdb_num_votes+audience_score+rotten+best_pic_nom+best_actress_win+best_dir_win,data=movies)

summary(m8)
```
```{r}
#Drop best_pic_nom

m9<-lm(formula=imdb_rating~title_type+genre+runtime+thtr_rel_month+dvd_rel_month+imdb_num_votes+audience_score+rotten+best_actress_win+best_dir_win,data=movies)

summary(m9)
```
```{r}
#Drop best_dir_win

m10<-lm(formula=imdb_rating~title_type+genre+runtime+thtr_rel_month+dvd_rel_month+imdb_num_votes+audience_score+rotten+best_actress_win,data=movies)

summary(m10)
```
```{r}
#Drop best+actress_win

m11<-lm(formula=imdb_rating~title_type+genre+runtime+thtr_rel_month+dvd_rel_month+imdb_num_votes+audience_score+rotten,data=movies)

summary(m11)
```
```{r}
#Drop dvd_rel_month

m12<-lm(formula=imdb_rating~title_type+genre+runtime+thtr_rel_month+imdb_num_votes+audience_score+rotten,data=movies)

summary(m12)
```
```{r}
#Drop thtr_rel_month

m13<-lm(formula=imdb_rating~title_type+genre+runtime+imdb_num_votes+audience_score+rotten,data=movies)

summary(m13)
```
```{r}
#Drop title_type

m14<-lm(formula=imdb_rating~genre+runtime+imdb_num_votes+audience_score+rotten,data=movies)

summary(m14)
```


In this model (m14), all the variables are significant since the p-value is lesser than 0.05. There are certain levels of genre that have a p-value of greater than 0.05, but since other levels like Documentary, Animation, etc. in genre have significant p-values, we cannot take out the genre variable from the model. Thus, we consider this to be our final model. The explanatory variables are able to explain 79.13% of the variability in the response variable, IMDB rating.

We can interpret the coefficients as follows: 


(A) **genre**: Let us take 2 levels, Documentary and Animation. All else held constant, an Animation movie is expected to have a lower IMDB rating by 0.486 points, a Documentary is expected to have a higher rating by 0.434 points. 

(B) **runtime**: All else held constant, an increase in runtime by 1 minute is expected to increase the IMDB rating by 0.004773 points. 

(C) **imdb_num_votes**: All else held constant, an increase in number of imdb votes by 1 is expected to increase the IMDB rating by 0.0000008125 points. 

(D) **audience_score**: All else held constant, an increase in audience score by 1% is expected to increase the IMDB score by 0.03724 points. 

(E) **rottenY**: All else held constant, movies with a rotten rating are expected to have an IMDB score of 0.2924 points lower than movies that are either fresh or certified fresh.

The interpretation of the intercept coefficient is meaningless to this exercise as a movie cannot have a runtime of 0 minutes. 

##Model Diagnostics 
###Linear Relationship between x and y 
>> For this, let us contruct residuals plots for each of the numeric variables. In this case, they are runtime, imdb_num_votes and audience_score

```{r}

residualdf<-data.frame(m14$residuals,movies$imdb_num_votes,movies$runtime,movies$audience_score)
names(residualdf)<-c("residuals","imdb_num_votes","runtime","audience_score")
plot1<-ggplot(data=residualdf,aes(x=imdb_num_votes,y=residuals))+geom_jitter()+geom_hline(yintercept=0)
plot2<-ggplot(data=residualdf,aes(x=runtime,y=residuals))+geom_point()+geom_hline(yintercept=0)
plot3<-ggplot(data=residualdf,aes(x=audience_score,y=residuals))+geom_point()+geom_hline(yintercept=0)

plot_grid(plot1,plot2,plot3,scale=1,ncol=2,labels="AUTO")

```


(A) **imdb_num_votes**: There seems to be a fan shape with movies with fewer number of votes showing more scatter of residuals, whereas, movies with higher number of votes show less scatter. This could indicate a potentially non-linear relationship.

(B) **runtime**: There is a hint of a fan shape in the distribution of the residuals, but it is not too obvious so the condition for linearity is not grossly violated. 

(C) **audience_score**: This residuals plot shows random scatter indicating a linear relationship. Only a few of the data points with lower audience score are showing larger variability in scatter of residuals, but it does not seem to be grossly violating the model conditions for linearity. 

###Nearly Normal Residuals 
>> To check this condition, we plot a histogram and qq plot of the residuals 

```{r}
plot1<-as.grob(expression(qqnorm(m14$residuals,main=NULL)))
plot2<-as.grob(expression(hist(m14$residuals,main=NULL)))

plot_grid(plot1,plot2,ncol=2,vjust=0)
```


There is a little bit of a left skew in the data, so this might be a cause for concern. 

###Constant Variability of Residuals 
>> To check this condition, we plot residuals vs fitted values 

```{r}
plot(m14$fitted,m14$residuals)

```

There is more variability around lower fitted values. Since there are fewer points showing this higher variability, this condition is not grossly violated.

###Independent Residuals 
>> To check this condition, we plot residuals vs order of data collection  

```{r}
plot(m14$residuals)

```


There is random scatter in this plot, thus we can conclude that ratings are independent of each other. 

* * *

# Part 5: Prediction
>> Let's take the movie: The Nice Guys. It's genre is Comedy, with a runtime of 116 min. On Rotten Tomatoes it has a audience score of 79% and it does not have a Rotten rating. On IMDB it has 260,365 votes. 

* Rotten Tomatoes: https://www.rottentomatoes.com/m/the_nice_guys 
* IMDB: https://www.imdb.com/title/tt3799694/ 

```{r}

predfilm<-data.frame(genre="Comedy",runtime=116,imdb_num_votes=260365,audience_score=79,rotten="N")
predict(m14,predfilm)

```

The IMDB rating for this movie is 7.4, so our prediction of 7.212593 is pretty close. Let's create a 95% confidence interval around this prediction. 

```{r}
predict(m14,predfilm,interval="prediction",level=0.95)
```
Hence, the model predicts, with 95% confidence, that a Comedy movie with a critic's score of 79%, a runtime of 116 minutes, 260,365 IMDB votes and not a "Rotten" rating is expected to have an IMDB rating between 6.2 and 8.2.   

* * *

# Part 6: Conclusion

With the model (m14) we are able to determine that genre, runtime, number of IMDB votes, audience score and critics rating have a relationship with IMDB rating. Thus, we can list these factors as contributing to the online popularity of a movie. 
There are a few reservations arising from the residual plots, which are indicative of a non-linear relationship, and I have flagged these. However, the conditions are not grossly violated. 

Since the attributes listed in the dataset can be limiting, as a next step, this research could collect more data points on the movies including memorability, character personalities, whether it is part of a  series, the advertising budget involved and other attributes that could potentially drive movie popularity. It could also collect data on non-English movies. 
